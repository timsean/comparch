\documentclass[10pt]{article}

\usepackage{graphicx}
\usepackage{float}
\usepackage{svg}
\usepackage[T1]{fontenc}
\usepackage[titletoc]{appendix}
\usepackage[margin=0.7in]{geometry}
\usepackage{blindtext}
\usepackage[english]{babel}
\usepackage{multirow}
\usepackage{courier}
\usepackage{fancyhdr}
\usepackage{makecell}
\pagestyle{fancy}
\lhead{Tim Yao - ty252}

\renewcommand{\thesubsection}{\thesection.\alph{subsection}}

\usepackage{listings}
\usepackage{color}

\definecolor{dkgreen}{rgb}{0,0.6,0}
\definecolor{gray}{rgb}{0.5,0.5,0.5}
\definecolor{mauve}{rgb}{0.58,0,0.82}

\lstset{frame=tb,
  language=Verilog,
  aboveskip=3mm,
  belowskip=3mm,
  showstringspaces=false,
  columns=flexible,
  keepspaces=true,
  basicstyle={\small\ttfamily},
  numbers=left,
  numberstyle=\tiny\color{gray},
  keywordstyle=\color{blue},
  commentstyle=\color{dkgreen},
  stringstyle=\color{mauve},
  breaklines=false,
  breakatwhitespace=true,
  tabsize=2
}

\title{ECE 4750 PSET 2}
\author{Tim Yao (ty252)}
\date{Oct 10, 2015}

\begin{document}
\maketitle
\newcommand*{\tableindent}{\hspace*{0.3cm}}%

\section{PARCv1 Instruction Cache} 
\subsection{Categorizing Cache Misses}
\begin{figure}[H]
\centering
\begin{tabular}{clcc}
\hline
\textbf{Addr} &\textbf{Instruction}& \textbf{Iteration 1} & \textbf{Iteration 2}\\
\hline
& loop: & & \\
\hline
0x108 & \tableindent addiu r1, r1, -1 & compulsory & \\
\hline
0x10c & \tableindent addiu r2, r2, -1 & 		   & \\
\hline
0x110 & \tableindent j foo			  & compulsory & conflict \\
\hline
	  & ...							  & 		   & \\
\hline
	  & foo:						  & 		   & \\
\hline
0x218 & \tableindent addiu r6, r6, 1  & compulsory & conflict \\
\hline
0x21c & \tableindent bne r1, r0, loop & 	       & \\
\hline
\end{tabular}
\caption{Cache Miss Type}
\end{figure}

\subsection{Average Memory Access Latency}
Looking at iteration 2, we can see that there are 2 misses out of the 5 instructions. Therefore the miss rate for 64 iterations of the loop is 0.4.\\The average memory access latency is: \\AMAL = (Hit Time) + (Miss Rate $\times$ Miss Penalty)\\AMAL = 1 + (0.4 $\times$ 5)\\AMAL = 3 cycles\\The AMAL is dominated by conflict misses, as shown by the miss chart above. Compulsory misses only occur on the first iteration of the loop.

\subsection{Set-Associativity}
The cache performance will increase significantly, because there will no longer be conflict misses during the loop. With this new cache microarchitecture, only compulsory misses will be left. 

\cleardoublepage
\section{Page-Based Memory Translation}

\subsection{Two-Level Page Tables}
The 16-bit virtual address is used as the following:
\begin{figure}[H]
\centering
\begin{tabular}{|c|c|c|}
\hline
Bits 14-15 & Bits 12-13 & Bits 0-11 \\
\hline
XX & XX & XXXXXXXXXXXX \\
\hline
\multicolumn{2}{|c|}{Virtual Page Number} & Page Offset \\
\hline
L1 Index & L2 Index & Page Offset \\
\hline
\end{tabular}
\caption{Virtual Address Usage}
\end{figure}
Page Tables:
\begin{figure}[H]
\centering
{
\begin{tabular}{@{\extracolsep{3pt}}lcc@{}}
\Xhline{2\arrayrulewidth}
& \multicolumn{2}{c}{\textbf{Page-Table Entry}} \\
\cline{2-3}
\textbf{Paddr of PTE} & \textbf{Valid} & \textbf{Paddr}\\
\Xhline{2\arrayrulewidth}
0xffffc & 1 & 0xfffe0 \\
\hline
0xffff8 & &  \\
\hline
0xffff4 & &  \\
\hline
0xffff0 & 1 & 0xfffb0 \\
\Xhline{2\arrayrulewidth}
0xfffec & 1 & 0x05000 \\
\hline
0xfffe8 & 1 & 0x07000 \\
\hline
0xfffe4 & &  \\
\hline
0xfffe0 & & \\
\Xhline{2\arrayrulewidth}
0xfffdc & & \\
\hline
0xfffd8 & &  \\
\hline
0xfffd4 & &  \\
\hline
0xfffd0 & & \\
\Xhline{2\arrayrulewidth}
0xfffcc & & \\
\hline
0xfffc8 & &  \\
\hline
0xfffc4 & &  \\
\hline
0xfffc0 & & \\
\Xhline{2\arrayrulewidth}
0xfffbc & 1 & 0x01000\\
\hline
0xfffb8 & 1 & 0x04000\\
\hline
0xfffb4 & 1 & 0x00000 \\
\hline
0xfffb0 & & \\
\Xhline{2\arrayrulewidth}
\end{tabular}
}
\caption{Contents of Physical Memory with Page Tables}
\end{figure}

\subsection{Translation-Lookaside Buffer}
\begin{figure}[H]
\centering
{
\begin{tabular}{@{\extracolsep{3pt}}ccccccccc@{}}
\hline
& & & & \textbf{Total} & & & & \\
\textbf{Transaction} & & \textbf{Page} & & \textbf{Num Mem} & \multicolumn{2}{c}{\textbf{TLB Way 0}} & \multicolumn{2}{c}{\textbf{TLB Way 1}} \\
\cline{6-7}
\cline{8-9}
\textbf{Address} & \textbf{VPN} & \textbf{Offset} & \textbf{m/h} & \textbf{Accesses} & \textbf{VPN} & \textbf{PPN} & \textbf{VPN} & \textbf{PPN} \\
\hline
0xeff4 & 0xe & 0xff4 & m & 3 & - & - & - & - \\
\hline
0x2ff0 & 0x2 & 0xff0 & m & 3 & 0xe & 0x07 & & \\
\hline
0xeff8 & 0xe & 0xff8 & h & 1 &  &  & 0x2 & 0x04 \\
\hline
0x2ff4 & 0x2 & 0xff4 & h & 1 & & & & \\
\hline
0xeffc & 0xe & 0xffc & h & 1 & & & & \\
\hline
0x2ff8 & 0x2 & 0xff8 & h & 1 & & & & \\
\hline
0xf000 & 0xf & 0x000 & m & 3 & & & & \\
\hline
0x2ffc & 0x2 & 0xffc & h & 1 & 0xf & 0x05 & & \\
\hline
0xf004 & 0xf & 0x004 & h & 1 & & & & \\
\hline
0x3000 & 0x3 & 0x000 & m & 3 & & & & \\
\hline
0xf008 & 0xf & 0x008 & h & 1 & & & 0x3 & 0x01 \\
\hline
0x3004 & 0x3 & 0x004 & h & 1 & & & 0x2 & 0x04 \\
\hline
0xf00c & 0xf & 0x00c & h & 1 & & & & \\
\hline
0x3008 & 0x3 & 0x008 & h & 1 & & & & \\
\hline
\end{tabular}
}
\caption{TLB Contents Over Time}
\end{figure}

\cleardoublepage
\section{Impact of Cache Access Time and Replacement Policy}

\subsection{Miss Rate Analysis}
\begin{figure}[H]
\centering
\begin{tabular}{@{\extracolsep{3pt}}cccccccccccc@{}}
\Xhline{2\arrayrulewidth}
\textbf{Transaction} & & & & & & & & & & & \\
\textbf{Address} & \textbf{tag} & \textbf{idx} & \textbf{m/h} & \textbf{L0} & \textbf{L1} & \textbf{L2} & \textbf{L3} & \textbf{L4} & \textbf{L5} & \textbf{L6} & \textbf{L7}\\
\Xhline{2\arrayrulewidth}
0x024 & 0x0 & 0x2 & m &  -  &  -  &  -  &  -  &  -  &  -  &  -  &  -  \\
0x030 & 0x0 & 0x3 & m &     &     & 0x0 &     &     &     &     &     \\
0x07c & 0x0 & 0x7 & m &     &     &     & 0x0 &     &     &     &     \\
0x070 & 0x0 & 0x7 & h &     &     &     &     &     &     &     & 0x0 \\
0x100 & 0x2 & 0x0 & m &     &     &     &     &     &     &     &     \\
0x110 & 0x2 & 0x1 & m & 0x2 &     &     &     &     &     &     &     \\
0x204 & 0x4 & 0x0 & m &     & 0x2 &     &     &     &     &     &     \\
0x214 & 0x4 & 0x1 & m & 0x4 &     &     &     &     &     &     &     \\
0x308 & 0x6 & 0x0 & m &     & 0x4 &     &     &     &     &     &     \\
0x110 & 0x2 & 0x1 & m & 0x6 &     &     &     &     &     &     &     \\
0x114 & 0x2 & 0x1 & h &     & 0x2 &     &     &     &     &     &     \\
0x118 & 0x2 & 0x1 & h &     &     &     &     &     &     &     &     \\
0x11c & 0x2 & 0x1 & h &     &     &     &     &     &     &     &     \\
0x410 & 0x8 & 0x1 & m &     &     &     &     &     &     &     &     \\
0x110 & 0x2 & 0x1 & m &     & 0x8 &     &     &     &     &     &     \\
0x510 & 0xa & 0x1 & m &     & 0x2 &     &     &     &     &     &     \\
0x110 & 0x2 & 0x1 & m &     & 0xa &     &     &     &     &     &     \\
0x610 & 0xc & 0x1 & m &     & 0x2 &     &     &     &     &     &     \\
0x110 & 0x2 & 0x1 & m &     & 0xc &     &     &     &     &     &     \\
0x710 & 0xe & 0x1 & m &     & 0x2 &     &     &     &     &     &     \\
\Xhline{2\arrayrulewidth}
\multicolumn{12}{l}{\textbf{Number of Misses = 16}} \\
\hline
\multicolumn{12}{l}{\textbf{Miss Rate = 0.8}} \\
\Xhline{2\arrayrulewidth}
\end{tabular}
\caption{Direct-Mapped Cache Contents Over Time}
\end{figure}

\begin{figure}[H]
\centering
{\setlength{\tabcolsep}{2pt}
\begin{tabular}{@{\extracolsep{3pt}}cccccccccccc@{}}
\Xhline{2\arrayrulewidth}
\textbf{Transaction} & & & & \multicolumn{2}{c}{\textbf{Set 0}} & \multicolumn{2}{c}{\textbf{Set 1}} & \multicolumn{2}{c}{\textbf{Set 2}} & \multicolumn{2}{c}{\textbf{Set 3}} \\
\cline{5-6}
\cline{7-8}
\cline{9-10}
\cline{11-12}
\textbf{Address} & \textbf{tag} & \textbf{idx} & \textbf{m/h} & \textbf{Way 0} & \textbf{Way 1} & \textbf{Way 0} & \textbf{Way 1} & \textbf{Way 0} & \textbf{Way 1} & \textbf{Way 0} & \textbf{Way 1} \\
\Xhline{2\arrayrulewidth}
0x024 & 0x0 & 0x2 & m &  -  &  -  &  -  &  -  &  -  &  -  &  -  &  -  \\
0x030 & 0x0 & 0x3 & m &     &     &     &     & 0x0 &     &     &     \\
0x07c & 0x1 & 0x3 & m &     &     &     &     &     &     & 0x0 &     \\
0x070 & 0x1 & 0x3 & h &     &     &     &     &     &     &     & 0x1 \\
0x100 & 0x4 & 0x0 & m &     &     &     &     &     &     &     &     \\
0x110 & 0x4 & 0x1 & m & 0x4 &     &     &     &     &     &     &     \\
0x204 & 0x8 & 0x0 & m &     &     & 0x4 &     &     &     &     &     \\
0x214 & 0x8 & 0x1 & m &     & 0x8 &     &     &     &     &     &     \\
0x308 & 0xc & 0x0 & m &     &     &     & 0x8 &     &     &     &     \\
0x110 & 0x4 & 0x1 & h & 0xc &     &     &     &     &     &     &     \\
0x114 & 0x4 & 0x1 & h &     &     &     &     &     &     &     &     \\
0x118 & 0x4 & 0x1 & h &     &     &     &     &     &     &     &     \\
0x11c & 0x4 & 0x1 & h &     &     &     &     &     &     &     &     \\
0x410 & 0x10& 0x1 & m &     &     &     &     &     &     &     &     \\
0x110 & 0x4 & 0x1 & h &     &     &     & 0x10&     &     &     &     \\
0x510 & 0x14& 0x1 & m &     &     &     &     &     &     &     &     \\
0x110 & 0x4 & 0x1 & h &     &     &     & 0x14&     &     &     &     \\
0x610 & 0x18& 0x1 & m &     &     &     &     &     &     &     &     \\
0x110 & 0x4 & 0x1 & h &     &     &     & 0x18&     &     &     &     \\
0x710 & 0x1c& 0x1 & m &     &     &     &     &     &     &     &     \\
\Xhline{2\arrayrulewidth}
\multicolumn{12}{l}{\textbf{Number of Misses = 12}} \\
\hline
\multicolumn{12}{l}{\textbf{Miss Rate = 0.6}} \\
\Xhline{2\arrayrulewidth}
\end{tabular}
}
\caption{Two-Way Set-Associative Cache Contents Over Time with LRU Replacement}
\end{figure}

\begin{figure}[H]
\centering
{\setlength{\tabcolsep}{2pt}
\begin{tabular}{@{\extracolsep{3pt}}cccccccccccc@{}}
\Xhline{2\arrayrulewidth}
\textbf{Transaction} & & & & \multicolumn{2}{c}{\textbf{Set 0}} & \multicolumn{2}{c}{\textbf{Set 1}} & \multicolumn{2}{c}{\textbf{Set 2}} & \multicolumn{2}{c}{\textbf{Set 3}} \\
\cline{5-6}
\cline{7-8}
\cline{9-10}
\cline{11-12}
\textbf{Address} & \textbf{tag} & \textbf{idx} & \textbf{m/h} & \textbf{Way 0} & \textbf{Way 1} & \textbf{Way 0} & \textbf{Way 1} & \textbf{Way 0} & \textbf{Way 1} & \textbf{Way 0} & \textbf{Way 1} \\
\Xhline{2\arrayrulewidth}
0x024 & 0x0 & 0x2 & m &  -  &  -  &  -  &  -  &  -  &  -  &  -  &  -  \\
0x030 & 0x0 & 0x3 & m &     &     &     &     & 0x0 &     &     &     \\
0x07c & 0x1 & 0x3 & m &     &     &     &     &     &     & 0x0 &     \\
0x070 & 0x1 & 0x3 & h &     &     &     &     &     &     &     & 0x1 \\
0x100 & 0x4 & 0x0 & m &     &     &     &     &     &     &     &     \\
0x110 & 0x4 & 0x1 & m & 0x4 &     &     &     &     &     &     &     \\
0x204 & 0x8 & 0x0 & m &     &     & 0x4 &     &     &     &     &     \\
0x214 & 0x8 & 0x1 & m &     & 0x8 &     &     &     &     &     &     \\
0x308 & 0xc & 0x0 & m &     &     &     & 0x8 &     &     &     &     \\
0x110 & 0x4 & 0x1 & h & 0xc &     &     &     &     &     &     &     \\
0x114 & 0x4 & 0x1 & h &     &     &     &     &     &     &     &     \\
0x118 & 0x4 & 0x1 & h &     &     &     &     &     &     &     &     \\
0x11c & 0x4 & 0x1 & h &     &     &     &     &     &     &     &     \\
0x410 & 0x10& 0x1 & m &     &     &     &     &     &     &     &     \\
0x110 & 0x4 & 0x1 & h &     &     &     & 0x10&     &     &     &     \\
0x510 & 0x14& 0x1 & m &     &     &     &     &     &     &     &     \\
0x110 & 0x4 & 0x1 & m &     &     & 0x14&     &     &     &     &     \\
0x610 & 0x18& 0x1 & m &     &     &     &     &     &     &     &     \\
0x110 & 0x4 & 0x1 & m &     &     &     & 0x18&     &     &     &     \\
0x710 & 0x1c& 0x1 & m &     &     &     &     &     &     &     &     \\
\Xhline{2\arrayrulewidth}
\multicolumn{12}{l}{\textbf{Number of Misses = 14}} \\
\hline
\multicolumn{12}{l}{\textbf{Miss Rate = 0.7}} \\
\Xhline{2\arrayrulewidth}
\end{tabular}
}
\caption{Two-Way Set-Associative Cache Contents Over Time with FIFO Replacement}
\end{figure}

\subsection{Sequential Tag Check then Memory Access}
\begin{figure}[H]
\centering
\begin{tabular}{@{\extracolsep{3pt}}llr@{}}
\hline
\textbf{Component} & \textbf{Delay Equation} & \textbf{Delay($\tau$)} \\
\hline
addr\_reg\_M0 & 1 & 1 \\
tag\_decoder & 3 + 2$\times$2 & 7 \\
tag\_mem 	& 10 + [(4+27)/16] & 12 \\
tag\_cmp		& 3 + 2[log2(26)] & 13 \\
tag\_and		& 2 - 1 & 1\\
data\_decoder& 3 + 2$\times$3 & 9 \\
data\_mem	& 10 + [(8+128)/16] & 19 \\
rdata\_mux	& 3[log2(4)] + [32/8] & 10 \\
rdata\_reg\_M1& 1 & 1 \\
\hline
\textbf{Total} & & \textbf{73} \\
\hline
addr\_reg\_M0 & 1 & 1 \\
tag\_decoder & 3 + 2$\times$2 & 7 \\
tag\_mem 	& 10 + [(4+27)/16] & 12 \\
tag\_cmp		& 3 + 2[log2(26)] & 13 \\
tag\_and		& 2 - 1 & 1\\
data\_decoder& 3 + 2$\times$3 & 9 \\
data\_mem	& 10 + [(8+128)/16] & 19 \\
\hline
\textbf{Total} & & \textbf{62} \\
\hline
\end{tabular}
\captionsetup{justification=centering}
\caption{Critical Path and Cycle Time for 2-Way Set-Associative Cache with 
\\ Serialized Tag Check before Data Access}
\end{figure}
The reason that the 2-way set-associative microarchitecture is slower than the direct-mapped microarchitecture is the need for the tag check result to go through the data\_decoder. It happens that the data\_decoder?s delay is relatively significant (9$\tau$). This connection is needed so that the data can be outputted from the correct way. 

\subsection{Parallel Read Hit Path}
\begin{figure}[H]
\centering
\begin{tabular}{@{\extracolsep{3pt}}llr@{}}
\hline
\textbf{Component} & \textbf{Delay Equation} & \textbf{Delay($\tau$)} \\
\hline
addr\_reg\_M0 & 1 & 1 \\
addr\_mux	& 3[log2(2)] + [5/8] & 4 \\
data\_decoder& 3 + 2$\times$3 & 9 \\
data\_mem	& 10 + [(8+128)/16] & 19 \\
rdata\_mux	& 3[log2(4)] + [32/8] & 10 \\
rdata\_reg\_M1& 1 & 1 \\
\hline
\textbf{Total} & & \textbf{44} \\
\hline
\end{tabular}
\caption{Critical Path and Cycle Time for Direct Mapped Cache with
\\ Parallel Read Hit}
\end{figure}
\begin{figure}[H]
\centering
\begin{tabular}{@{\extracolsep{3pt}}llr@{}}
\hline
\textbf{Component} & \textbf{Delay Equation} & \textbf{Delay($\tau$)} \\
\hline
addr\_reg\_M0 & 1 & 1 \\
addr\_mux	& 3[log2(2)] + [5/8] & 4 \\
data\_decoder& 3 + 2$\times$2 & 7 \\
data\_mem	& 10 + [(8+128)/16] & 19 \\
rdata\_mux	& 3[log2(4)] + [32/8] & 10 \\
way\_mux		& 3[log2(2)] + [32/8] & 7 \\
rdata\_reg\_M1& 1 & 1 \\
\hline
\textbf{Total} & & \textbf{49} \\
\hline
\end{tabular}
\caption{Critical Path and Cycle Time for 2-Way Set-Associative Cache with
\\ Parallel Read Hit}
\end{figure}
The reason that the 2-way set-associative microarchitecture is slower than the direct-mapped microarchitecture is the way\_mux, which is needed to output the data from the correct way. This mux has a delay of 7$\tau$, which is relatively significant. 

\subsection{Pipelined Write Hit Path}
\begin{figure}[H]
\centering
\begin{tabular}{@{\extracolsep{3pt}}llr@{}}
\hline
\textbf{Component} & \textbf{Delay Equation} & \textbf{Delay($\tau$)} \\
\hline
addr\_reg\_M0 & 1 & 1 \\
tag\_decoder & 3 + 2$\times$3 & 9 \\
tag\_mem 	& 10 + [(8+26)/16] & 13 \\
tag\_cmp		& 3 + 2[log2(25)] & 13 \\
tag\_and		& 2 - 1 & 1\\
wen\_and		& 2 - 1 & 1\\
wen\_reg\_M1	& 1 & 1\\
\hline
\textbf{Total} & & \textbf{39} \\
\hline
\end{tabular}
\caption{Critical Path and Cycle Time for Direct Mapped Cache with
\\ Pipelined Write Hit}
\end{figure}
\begin{figure}[H]
\centering
\begin{tabular}{@{\extracolsep{3pt}}llr@{}}
\hline
\textbf{Component} & \textbf{Delay Equation} & \textbf{Delay($\tau$)} \\
\hline
addr\_reg\_M0 & 1 & 1 \\
tag\_decoder & 3 + 2$\times$2 & 7 \\
tag\_mem 	& 10 + [(4+27)/16] & 12 \\
tag\_cmp		& 3 + 2[log2(25)] & 13 \\
tag\_and		& 2 - 1 & 1\\
wen\_and		& 2 - 1 & 1\\
wen\_reg\_M1	& 1 & 1\\
\hline
\textbf{Total} & & \textbf{36} \\
\hline
\end{tabular}
\caption{Critical Path and Cycle Time for 2-Way Set-Associative Cache with
\\ Pipelined Write Hit}
\end{figure}

\subsection{Average Memory Access Latency}
\begin{figure}[H]
\centering
\begin{tabular}{@{\extracolsep{3pt}}ccccccc@{}}
\Xhline{2\arrayrulewidth}
& & & \textbf{Hit} & \textbf{Miss} & \textbf{Miss} & \\
& & \textbf{Replacement} & \textbf{Time} & \textbf{Rate} & \textbf{Penalty} & \textbf{AMAL} \\
\textbf{Associativity} & \textbf{$\mu$arch} & \textbf{Policy} & \textbf{($\tau$)} & \textbf{(ratio)} & \textbf{($\tau$)} & \textbf{($\tau$)} \\
\Xhline{2\arrayrulewidth}
Direct Mapped   & Seq & n/a & 68 & 0.8 & 300 & 308\\
2-way Set Assoc & Seq & LRU & 73 & 0.6 & 300 & 253\\
2-way Set Assoc & Seq & FIFO& 73 & 0.7 & 300 & 283\\
Direct Mapped   & PP  & n/a & 44 & 0.8 & 300 & 284\\
2-way Set Assoc & PP  & LRU & 49 & 0.6 & 300 & 229\\
2-way Set Assoc & PP  & FIFO& 49 & 0.7 & 300 & 259\\
\hline
\Xhline{2\arrayrulewidth}
\end{tabular}
\caption{Average Memory Access Latency for Six Cache Configurations}
\end{figure}

\end{document}